var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TemplatesPanel=void 0;const t=e(require("react")),r=require("mobx-react-lite"),a=require("@blueprintjs/core"),i=require("nanoid"),l=require("../model/group-model"),s=require("@blueprintjs/icons"),n=require("../utils/l10n"),o=require("./images-grid"),u=require("../utils/api"),d=require("../utils/use-api"),c=(e,r)=>{const a=t.default.useRef(!0);t.default.useEffect((()=>{a.current?a.current=!1:e()}),r)},h=(0,r.observer)((({sizeQuery:e,query:r,store:a})=>{const{setQuery:s,loadMore:n,hasMore:h,data:g,isLoading:p,reset:f,error:m}=(0,d.useInfiniteAPI)({getAPI:({page:t,query:r})=>(0,u.templateList)({page:t,query:r,sizeQuery:e}),getSize:e=>e.totalPages});return c((()=>{f()}),[e]),c((()=>{s(r)}),[r]),t.default.createElement(o.ImagesGrid,{images:null==g?void 0:g.map((e=>e.items)).flat(),getPreview:e=>e.preview,isLoading:p,onSelect:async e=>{const t=await fetch(e.json),r=await t.json();if(a.pages.length<=1){a.loadJSON(r,!0)}else{const e=JSON.parse(JSON.stringify(a.toJSON()));e.width===r.width&&e.height===r.height||r.pages.forEach((e=>{e.width=e.width||r.width,e.height=e.height||r.height})),(0,l.forEveryChild)({children:r.pages},(e=>{e.id=(0,i.nanoid)(10)}));const t=a.pages.indexOf(a.activePage);e.pages.splice(t,1,...r.pages),a.loadJSON(e,!0)}},loadMore:h&&n,error:m})}));exports.TemplatesPanel=(0,r.observer)((({store:e})=>{const[r,i]=t.default.useState(!0),[l,o]=t.default.useState(""),u=r?`${e.width}x${e.height}`:"all";return t.default.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},t.default.createElement(a.InputGroup,{leftIcon:t.default.createElement(s.Search,null),placeholder:(0,n.t)("sidePanel.searchPlaceholder"),type:"search",onChange:e=>{o(e.target.value)},style:{marginBottom:"20px"}}),t.default.createElement(a.Switch,{checked:r,onChange:e=>{i(e.target.checked)},alignIndicator:a.Alignment.RIGHT,style:{marginTop:"8px",marginBottom:"25px"}},(0,n.t)("sidePanel.searchTemplatesWithSameSize")," "),t.default.createElement(h,{store:e,sizeQuery:"size="+u,query:l}))}));