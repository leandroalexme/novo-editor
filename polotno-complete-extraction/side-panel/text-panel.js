var e=this&&this.__rest||function(e,t){var o={};for(var n in e){Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n])}if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++){t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}}return o},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextPanel=void 0;const o=t(require("react")),n=require("mobx-react-lite"),l=require("@blueprintjs/core"),i=t(require("swr")),a=require("@blueprintjs/icons"),r=require("../utils/l10n"),s=t(require("../utils/styled")),d=require("../utils/screen"),c=require("./images-grid"),f=require("../utils/api"),u=require("../utils/use-api"),m=require("../canvas/page"),p=(0,s.default)("div")`
  height: calc(100% - 40px);
  display: flex;
  flex-direction: column;

  .bp5-dark & .polotno-text-preview-plain {
    filter: invert(1);
  }
`,g=(0,s.default)("div")`
  height: 100px;
  cursor: pointer;
  box-shadow: 0 0 5px rgba(16, 22, 26, 0.3);
  border-radius: 5px;
  background-color: rgba(0, 0, 0, 0.4);
  position: relative;
  font-size: 25px;
  display: flex;
  justify-content: center;
  align-content: center;
  flex-direction: column;
  text-align: center;
  color: white;
  margin-bottom: 10px;
`,h=e=>new Promise(((t,o)=>{const n=new FileReader;n.readAsDataURL(e),n.onload=()=>t(n.result),n.onerror=e=>o(e)})),y=(0,n.observer)((({onSelect:e,onRemove:t,font:n})=>o.default.createElement(g,{style:{fontFamily:n.fontFamily},className:"polotno-font-item",onClick:e},n.fontFamily," text",o.default.createElement(l.Button,{style:{position:"absolute",right:0,bottom:0},minimal:!0,icon:o.default.createElement(a.Trash,null),onClick:e=>{e.stopPropagation(),t()}})))),x=t=>{var{onSelect:n}=t,i=e(t,["onSelect"]);return o.default.createElement(l.Button,Object.assign({},i,{draggable:!0,className:"polotno-close-panel",onClick:()=>n(),onDragStart:()=>{(0,m.registerNextDomDrop)((({x:e,y:t})=>{n({x:e,y:t})}))},onDragEnd:e=>{(0,m.registerNextDomDrop)(null)}}))};exports.TextPanel=(0,n.observer)((({store:e})=>{o.default.useEffect((()=>{e.loadFont("Roboto")}),[]);const t=t=>{var o;const n=t.width||e.width/2,l=((null==t?void 0:t.x)||e.width/2)-n/2,i=((null==t?void 0:t.y)||e.height/2)-t.fontSize/2,a=(e.width+e.height)/2160,r=null===(o=e.activePage)||void 0===o?void 0:o.addElement(Object.assign(Object.assign({type:"text",fontFamily:"Roboto"},t),{x:l,y:i,width:n,fontSize:t.fontSize*a}));(0,d.isMobile)()||null==r||r.toggleEditMode(!0)};o.default.useEffect((()=>{e.fonts.forEach((t=>e.loadFont(t.fontFamily)))}),[e.fonts]);const{data:n,error:s}=(0,i.default)((0,f.textTemplateList)(),u.fetcher),[m,g]=o.default.useState("text");return o.default.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},o.default.createElement(l.Tabs,{large:!0,onChange:e=>g(e)},o.default.createElement(l.Tab,{id:"text"},(0,r.t)("sidePanel.text")),o.default.createElement(l.Tab,{id:"font"},(0,r.t)("sidePanel.myFonts"))),"text"===m&&o.default.createElement(p,null,o.default.createElement(x,{style:{marginBottom:"5px",width:"100%",fontSize:"25px",fontFamily:"Roboto"},minimal:!0,onSelect:e=>{t(Object.assign(Object.assign({},e),{fontSize:76,text:(0,r.t)("sidePanel.headerText"),fontFamily:"Roboto"}))}},(0,r.t)("sidePanel.createHeader")),o.default.createElement(x,{style:{marginBottom:"5px",width:"100%",fontSize:"18px",fontFamily:"Roboto"},minimal:!0,onSelect:e=>{t(Object.assign(Object.assign({},e),{fontSize:44,text:(0,r.t)("sidePanel.subHeaderText"),fontFamily:"Roboto"}))}},(0,r.t)("sidePanel.createSubHeader")),o.default.createElement(x,{style:{marginBottom:"5px",width:"100%",fontSize:"14px",fontFamily:"Roboto"},minimal:!0,onSelect:e=>{t(Object.assign(Object.assign({},e),{fontSize:30,text:(0,r.t)("sidePanel.bodyText"),fontFamily:"Roboto"}))}},(0,r.t)("sidePanel.createBody")),o.default.createElement(c.ImagesGrid,{shadowEnabled:!1,images:null==n?void 0:n.items,getPreview:e=>e.preview,getImageClassName:e=>e.json.indexOf("plain")>=0?"polotno-text-preview-plain":"",isLoading:!n,error:s,onSelect:async(t,o)=>{const n=await fetch(t.json),l=await n.json();if(!e.activePage){return}const i=(e.width+e.height)/2160,a=o?o.x-l.width/2*i:e.width/2-l.width/2*i,r=o?o.y-l.height/2*i:e.height/2-l.height/2*i;e.history.transaction((()=>{const t=l.pages[0].children,o=[];t.forEach((t=>{var n;delete t.id;const{id:l}=null===(n=e.activePage)||void 0===n?void 0:n.addElement(Object.assign(Object.assign({},t),{fontSize:t.fontSize*i,x:t.x*i+a,y:t.y*i+r,width:t.width*i,height:t.height*i}));o.push(l)})),e.selectElements(o)}))}})),"font"===m&&o.default.createElement("div",{style:{display:"flex",flexDirection:"column",height:"calc(100% - 50px)"}},o.default.createElement("label",{htmlFor:"polotno-font-upload"},o.default.createElement(l.Button,{icon:o.default.createElement(a.Upload,null),style:{width:"100%"},onClick:()=>{var e;null===(e=document.querySelector("#polotno-font-upload"))||void 0===e||e.click()}},(0,r.t)("sidePanel.uploadFont")),o.default.createElement("input",{type:"file",accept:".ttf, .otf, .woff, .woff2, .eot",id:"polotno-font-upload",style:{display:"none"},onChange:async t=>{const{target:o}=t;for(const n of o.files){const t=await h(n),o=n.name.split(".")[0].replace(/,/g,"");e.addFont({fontFamily:o,url:t})}o.value=null}})),o.default.createElement("div",{style:{paddingTop:"20px",overflow:"auto",height:"100%"}},e.fonts.map(((n,l)=>o.default.createElement(y,{font:n,key:l,onSelect:()=>{t({fontSize:80,text:"Cool text",fontFamily:n.fontFamily})},onRemove:()=>{e.find((e=>{"text"===e.type&&e.fontFamily===n.fontFamily&&e.set({fontFamily:"Roboto"})})),e.removeFont(n.fontFamily)}}))))))}));