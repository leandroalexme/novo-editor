var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Tooltip=void 0;const t=e(require("react")),n=require("mobx-react-lite"),l=require("react-konva-utils"),o=require("@blueprintjs/core"),r=require("../utils/math"),a=require("../toolbar/element-container"),u=require("../toolbar/text-ai-write"),i=require("../toolbar/duplicate-button"),s=require("../toolbar/remove-button"),c=require("../toolbar/position-picker"),d=require("../toolbar/group-button");function f(e,t){return e.classList.contains(t)?e:e.parentElement?f(e.parentElement,t):null}const p=()=>null;exports.Tooltip=(0,n.observer)((({store:e,page:n,components:v,stageRef:m})=>{var g,E;const h=(0,r.getTotalClientRect)(e.selectedShapes),b=e.selectedShapes.every((e=>e.page===n)),k=t.default.useRef(null),[x,y]=t.default.useState(!1),C=e._hasCroppedImages;e.selectedElements.length,t.default.useEffect((()=>{var e,t,n;const l=()=>{y(!0)},o=()=>{y(!1)};null===(e=null==m?void 0:m.current)||void 0===e||e.on("dragstart",l),null===(t=null==m?void 0:m.current)||void 0===t||t.on("dragend",o);const r=null===(n=null==m?void 0:m.current)||void 0===n?void 0:n.findOne("Transformer");return null==r||r.on("transformstart",l),null==r||r.on("transformend",o),()=>{var e,t;null===(e=null==m?void 0:m.current)||void 0===e||e.off("dragstart",l),null===(t=null==m?void 0:m.current)||void 0===t||t.off("dragend",o),null==r||r.off("transformstart",l),null==r||r.off("transformend",o)}}),[]);const[q,R]=t.default.useState({fit:!0,needCalculate:!1,token:Math.random()});if(t.default.useEffect((()=>{0!==e.selectedElements.length&&R({fit:!0,needCalculate:!0,token:Math.random()})}),[e.selectedElements,x]),t.default.useEffect((()=>{setTimeout((()=>{if(!k.current){return}if(!q.needCalculate){return}const e=f(k.current,"polotno-workspace-container");if(!e){return}const t=e.getBoundingClientRect(),n=k.current.getBoundingClientRect(),l=(n.right,t.left,n.top-t.top),o=(n.left,t.left,n.bottom-t.top);l<20&&q.fit&&R({fit:!1,needCalculate:!1,token:q.token}),o-t.height>-20&&!q.fit&&R({fit:!0,needCalculate:!1,token:q.token})}),10)}),[q.needCalculate,k.current,q.token]),t.default.useEffect((()=>{const t=f(m.current.content,"polotno-workspace-inner"),n=()=>{e.selectedElements.length&&R({fit:!0,needCalculate:!0,token:Math.random()})};return null==t||t.addEventListener("scroll",n),()=>{null==t||t.removeEventListener("scroll",n)}}),[]),0===e.selectedShapes.length){return null}if(x){return null}if(!b){return null}if(e.activePage!==n){return null}if(C){return null}const T=(null==v?void 0:v.Position)||c.PositionPicker,B=(null==v?void 0:v.Duplicate)||i.DuplicateButton,M=(null==v?void 0:v.Remove)||s.RemoveButton,_=(null==v?void 0:v.Group)||d.GroupButton,w=(null==v?void 0:v.Lock)||p,O=e.selectedElements[0].type,P=Object.assign({TextAiWrite:u.TextAiWrite},v),j=(0,a.extendToolbar)({components:P,type:O,usedItems:[]}),S=(null===(E=null===(g=null==m?void 0:m.current)||void 0===g?void 0:g.findOne("Transformer"))||void 0===E?void 0:E.rotation())||0;let L=30;return Math.abs(S)<30&&q.fit&&(L=80),Math.abs(S)>140&&!q.fit&&(L=80),t.default.createElement(l.Html,{parentNodeFunc:({stage:e})=>{var t,n;return(null===(t=null==e?void 0:e.container())||void 0===t?void 0:t.closest(".polotno-workspace-container"))||(null===(n=null==e?void 0:e.container())||void 0===n?void 0:n.parentNode)},transformFunc:e=>{var t;const n=h.x+h.width/2,l=q.fit?h.y*e.scaleY-L:h.y*e.scaleY+h.height*e.scaleY+L,o=null===(t=null==m?void 0:m.current)||void 0===t?void 0:t.container(),r=(null==o?void 0:o.getBoundingClientRect())||{left:0,top:0},a=null==o?void 0:o.closest(".polotno-workspace-container"),u=(null==a?void 0:a.getBoundingClientRect())||{left:0,top:0},i=r.left-u.left,s=r.top-u.top;return Object.assign(Object.assign({},e),{x:i+e.x+n*e.scaleX,y:s+e.y+l,scaleX:1,scaleY:1})},divProps:{style:{pointerEvents:"none",position:"absolute",zIndex:9}}},t.default.createElement("div",{ref:k,style:{pointerEvents:"none"}},t.default.createElement(o.Navbar,{style:{padding:"2px",borderRadius:"5px",height:"34px",transform:"translate(-50%, -50%)",pointerEvents:"auto"}},t.default.createElement(o.NavbarGroup,{style:{height:"30px"}},j.map((n=>{const l=P[n];return t.default.createElement(l,{elements:e.selectedElements,element:e.selectedElements[0],store:e,key:n})})),t.default.createElement(_,{store:e}),t.default.createElement(w,{store:e}),t.default.createElement(B,{store:e}),t.default.createElement(M,{store:e}),t.default.createElement(T,{store:e})))))}));