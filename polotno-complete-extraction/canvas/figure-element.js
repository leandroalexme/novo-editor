var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.FigureElement=void 0;const t=e(require("react")),a=require("mobx-react-lite"),r=require("react-konva"),s=require("../utils/figure-to-svg"),o=require("../utils/screen"),i=require("./use-color"),l={};exports.FigureElement=(0,a.observer)((({element:e,store:n})=>{const h=e.selectable||"admin"===n.role,d=(0,o.isTouchDevice)(),c=n.selectedShapes.indexOf(e)>=0&&e.selectable,u=Math.min(e.strokeWidth,e.width/2,e.height/2),g=Math.max(0,Math.min(e.width/2,e.height/2,e.cornerRadius)),f=(0,i.useColor)(e,e.a.fill,"fill"),p=Object.assign(Object.assign({width:e.a.width,height:e.a.height},f),{cornerRadius:g,opacity:e.animated("opacity"),shadowEnabled:e.shadowEnabled,shadowBlur:e.shadowBlur,shadowOffsetX:e.shadowOffsetX,shadowOffsetY:e.shadowOffsetY,shadowColor:e.shadowColor,shadowOpacity:e.shadowOpacity,preventDefault:!d||c,hideInExport:!e.showInExport}),m=(0,i.useColor)(e,e.stroke,"stroke"),b=Object.assign(Object.assign({visible:u>0,x:u/2,y:u/2,width:e.a.width-u,height:e.a.height-u},m),{strokeWidth:u,cornerRadius:Math.max(0,g-u),dash:e.dash.map((e=>e*u)),opacity:e.animated("opacity"),hideInExport:!e.showInExport,listening:!1}),w=(y=e.subType,l[y]||(l[y]=(x=(0,s.subTypeToPathDataFunc)(y),(0,a.observer)((({element:e,fillProps:a,strokeProps:s})=>{let o=x({width:e.a.width,height:e.a.height,cornerRadius:e.cornerRadius}),i=1,l=1;"string"!=typeof o&&(i=o.scaleX,l=o.scaleY,o=o.path);const n=t.default.useRef(null);return t.default.createElement(t.default.Fragment,null,t.default.createElement(r.Rect,{width:e.width,height:e.height,fill:"transparent"}),t.default.createElement(r.Path,Object.assign({},a,{ref:n,data:o,scaleX:i,scaleY:l})),t.default.createElement(r.Group,{clipFunc:e=>{const t=n.current;if(t){var a=t.dataArray;e.beginPath();for(var r=0;r<a.length;r++){var s=a[r].command,o=a[r].points;switch(s){case"L":e.lineTo(o[0],o[1]);break;case"M":e.moveTo(o[0],o[1]);break;case"C":e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]);break;case"Q":e.quadraticCurveTo(o[0],o[1],o[2],o[3]);break;case"A":var i=o[0],l=o[1],h=o[2],d=o[3],c=o[4],u=o[5],g=o[6],f=o[7],p=h>d?h:d,m=h>d?1:h/d,b=h>d?d/h:1;e.translate(i,l),e.rotate(g),e.scale(m,b),e.arc(0,0,p,c,c+u,1-f),e.scale(1/m,1/b),e.rotate(-g),e.translate(-i,-l);break;case"z":e.closePath()}}}},scaleX:i,scaleY:l},t.default.createElement(r.Path,Object.assign({},s,{x:0,y:0,data:o,strokeWidth:2*s.strokeWidth,dash:s.dash.map((e=>e))}))))})))),l[y]||r.Group);var y,x;return t.default.createElement(t.default.Fragment,null,t.default.createElement(r.Group,{id:e.id,x:e.a.x,y:e.a.y,rotation:e.a.rotation,opacity:e.a.opacity,listening:h,draggable:d?e.draggable&&c:e.draggable,name:"element",onDragMove:t=>{e.set({x:t.target.x(),y:t.target.y()})},onDragEnd:t=>{e.set({x:t.target.x(),y:t.target.y()})},onTransform:t=>{const a=t.target.scale();t.target.scaleX(1),t.target.scaleY(1),e.set({width:e.width*a.x,height:e.height*a.y,x:t.target.x(),y:t.target.y(),rotation:t.target.rotation()})}},t.default.createElement(w,{element:e,fillProps:p,strokeProps:b})))}));