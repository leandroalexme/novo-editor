var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.useSvgColors=exports.sameColors=void 0,exports.urlToBase64=async function(t){const e=await fetch(t);return d(await e.text())},exports.urlToString=c,exports.getColors=f,exports.svgToURL=d,exports.getSvgSize=async function(t){const e=await c(t),r=(new DOMParser).parseFromString(e,"image/svg+xml").documentElement.getAttribute("viewBox"),[o,n,s,l]=(null==r?void 0:r.split(" "))||[];return{width:parseFloat(s),height:parseFloat(l)}},exports.fixSize=function(t){var e=(new DOMParser).parseFromString(t,"image/svg+xml");const r=e.documentElement.getAttribute("viewBox"),[o,n,s,l]=(null==r?void 0:r.split(" "))||[],i=e.documentElement.getAttribute("width");i||e.documentElement.setAttribute("width",s+"px");const a=e.documentElement.getAttribute("height");if((!a||a.indexOf("%")>=0)&&e.documentElement.setAttribute("height",l+"px"),i&&i.indexOf("%")>=0&&a&&-1===a.indexOf("%")){const t=parseFloat(a)/parseFloat(l);e.documentElement.setAttribute("width",t*parseFloat(s)+"px")}if(a&&a.indexOf("%")>=0&&i&&-1===i.indexOf("%")){const t=parseFloat(i)/parseFloat(s);e.documentElement.setAttribute("height",t*parseFloat(l)+"px")}return"100%"===i&&"100%"===a&&(e.documentElement.setAttribute("width",s+"px"),e.documentElement.setAttribute("height",l+"px")),(new XMLSerializer).serializeToString(e)},exports.replaceColors=function(t,r){var n=(new DOMParser).parseFromString(t,"image/svg+xml");const s=u(n),a=Array.from(r.keys()),c=l(n);return s.forEach((t=>{const{fill:s,stroke:l}=i(t,c);[{prop:"fill",color:s},{prop:"stroke",color:l}].forEach((({prop:s,color:l})=>{const i=a.find((t=>(0,exports.sameColors)(t,l)));if(i){const l=r.get(i);if((0,o.isGradient)(l)){const{rotation:r,stops:i}=(0,o.parseColor)(l),a=i.map((t=>({offset:100*t.offset+"%","stop-color":t.color}))),u="color"+Math.round(1e8*Math.random());!function(t,r,o,n){var s=t.namespaceURI,l=document.createElementNS(s,"linearGradient");const i=e.default.Util.degToRad(o+90),a=(Math.cos(i)+1)/2,u=(Math.sin(i)+1)/2,c=(Math.cos(i+Math.PI)+1)/2,f=(Math.sin(i+Math.PI)+1)/2;l.setAttribute("x1",100*a+"%"),l.setAttribute("y1",100*u+"%"),l.setAttribute("x2",100*c+"%"),l.setAttribute("y2",100*f+"%"),l.setAttribute("gradientUnits","userSpaceOnUse"),l.setAttribute("id",r);for(var d=0;d<n.length;d++){var p=n[d],m=document.createElementNS(s,"stop");for(var g in p){p.hasOwnProperty(g)&&m.setAttribute(g,p[g])}l.appendChild(m)}(t.querySelector("defs")||t.insertBefore(document.createElementNS(s,"defs"),t.firstChild)).appendChild(l)}(n.children[0],u,r,a),t.style[s]=null,t.setAttribute(s,`url('#${u}')`)}else{t.style[s]=r.get(i)}}}))})),d((new XMLSerializer).serializeToString(n))};const e=t(require("konva")),r=t(require("react")),o=require("./gradient"),n=t(require("mensch"));function s(t){for(;t.parentNode;){if("defs"===t.nodeName){return!0}t=t.parentNode}return!1}function l(t){const e={};return t.querySelectorAll("style").forEach((t=>{const r=n.default.parse(t.textContent).stylesheet.rules;for(let o of r){o.selectors&&o.selectors.forEach((t=>{const r=e[t]||{};o.declarations.forEach((t=>{r[t.name]=t.value})),e[t]=r}))}})),e}function i(t,e){var r;const o={fill:"",stroke:""},n=(null===(r=t.getAttribute("class"))||void 0===r?void 0:r.split(" "))||[],s=t.getAttribute("id");let l={};if(s&&e[`#${s}`]?l=e[`#${s}`]:n.forEach((t=>{e[`.${t}`]&&(l=Object.assign(Object.assign({},l),e[`.${t}`]))})),e[t.nodeName]&&(l=Object.assign(Object.assign({},l),e[t.nodeName])),t.getAttribute("fill")&&"none"!==t.getAttribute("fill")?o.fill=t.getAttribute("fill"):l.fill&&"none"!==l.fill&&(o.fill=l.fill),t.getAttribute("stroke")&&"none"!==t.getAttribute("stroke")?o.stroke=t.getAttribute("stroke"):l.stroke&&"none"!==l.stroke&&(o.stroke=l.stroke),!o.fill&&t.style.fill&&"none"!==t.style.fill&&(o.fill=t.style.fill),!o.stroke&&t.style.stroke&&"none"!==t.style.stroke&&(o.stroke=t.style.stroke),!o.stroke&&!o.fill){const r=t.ownerSVGElement,n=r&&r!==t&&i(r,e);"currentColor"===(null==n?void 0:n.fill)||"currentColor"===(null==n?void 0:n.stroke)||(o.fill="black")}return o}const a=["path","rect","circle","line","polygon","polyline","ellipse","text"];function u(t){for(var e=[],r=t.getElementsByTagName("*"),o=0,n=r.length;o<n;o++){const t=r[o];s(t)||(null!==t.getAttribute("fill")&&e.push(t),(null!==t.getAttribute("stroke")||t.style&&t.style.fill||a.indexOf(t.nodeName)>=0)&&e.push(t))}return e}async function c(t){const e=await fetch(t,{mode:"cors"});return await e.text()}function f(t){var r=(new DOMParser).parseFromString(t,"image/svg+xml");const o=l(r),n=u(r),s=[];return n.forEach((t=>{const{fill:r,stroke:n}=i(t,o);[r,n].forEach((t=>{t&&("currentColor"===t&&(t="black"),e.default.Util.colorToRGBA(t)&&-1===s.indexOf(t)&&s.push(t))}))})),s}function d(t){return"data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(t)))}exports.sameColors=(t,r)=>{if(!t||!r){return!1}if("currentColor"===r&&"black"===t){return!0}const o=e.default.Util.colorToRGBA(t),n=e.default.Util.colorToRGBA(r);return o&&n?o.r===n.r&&o.g===n.g&&o.b===n.b&&o.a===n.a:void 0},exports.useSvgColors=t=>{const[e,o]=r.default.useState([]);return r.default.useEffect((()=>{let e=!1;return(async()=>{o([]);const r=f(await c(t));e||o(r)})(),()=>{e=!0}}),[t]),e};