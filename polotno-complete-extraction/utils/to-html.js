var e,t=this&&this.__createBinding||(Object.create?function(e,t,i,o){void 0===o&&(o=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,o,r)}:function(e,t,i,o){void 0===o&&(o=i),e[o]=t[i]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(e=function(t){return e=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e){Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i)}return t},e(t)},function(o){if(o&&o.__esModule){return o}var r={};if(null!=o){for(var n=e(o),s=0;s<n.length;s++){"default"!==n[s]&&t(r,o,n[s])}}return i(r,o),r}),r=this&&this.__rest||function(e,t){var i={};for(var o in e){Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o])}if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++){t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(i[o[r]]=e[o[r]])}}return i};Object.defineProperty(exports,"__esModule",{value:!0}),exports.fixRatio=function(e){var t=(new DOMParser).parseFromString(e,"image/svg+xml");return t.documentElement.setAttribute("preserveAspectRatio","none"),(new XMLSerializer).serializeToString(t)},exports.jsonToDOM=y,exports.jsonToHTML=async function({json:e,elementHook:t}){const i=await y({json:e,elementHook:t});return w({dom:i})};const n=require("./image"),s=o(require("./svg")),a=require("./image"),l=require("./figure-to-svg"),h=require("./html2canvas"),c=require("./filters"),d=require("./video"),p=require("./fonts"),g=(e,t,...i)=>({type:e,props:t,children:i||[]}),u=async({element:e,page:t,store:i})=>{let{src:o}=e;if("svg"===e.type&&Object.keys(e.colorsReplace).length){const t=await s.urlToString(o);o=s.replaceColors(t,new Map(Object.entries(e.colorsReplace)))}let r="";e.flipX&&(r+="scaleX(-1)"),e.flipY&&(r+="scaleY(-1)"),r||(r="none");const n={};if(e.clipSrc){const t=await s.urlToBase64(e.clipSrc);n["clip-path"]=`url(${t})`}const l=await(0,a.loadImage)(o),h=l.width*e.cropWidth,c=l.height*e.cropHeight,d=e.width/e.height;let p,u;const f=h/c;"svg"===e.type?(p=h,u=c):d>=f?(p=h,u=h/d):(p=c*d,u=c);const b=p/l.width,m=u/l.height,y=p/u>e.width/e.height?e.height/u:e.width/p,w=p*y/b,x=u*y/m,$=e.cropX*y*l.width,O=e.cropY*y*l.height;return g("div",{style:Object.assign(Object.assign({},n),{width:"100%",height:"100%","border-radius":e.cornerRadius+"px",border:e.borderSize?`${e.borderSize}px solid ${e.borderColor}`:"none",backgroundRepeat:"no-repeat",background:`url(${o})`,transform:r,"background-size":`${Math.round(w)}px ${Math.round(x)}px`,"background-position-x":-Math.round($)+"px","background-position-y":-Math.round(O)+"px"})})},f=({element:e,type:t})=>{const i={"stroke-width":e.height,stroke:e.color,"line-cap":"round","stroke-linejoin":"round",opacity:e.opacity};return"arrow"===t||"triangle"===t?g("polyline",Object.assign({points:`${3*e.height},${2*-e.height} 0,0 ${3*e.height},${2*e.height}`},i)):"bar"===t?g("polyline",Object.assign({points:`0,${2*-e.height} 0,${2*e.height}`},i)):"circle"===t?g("circle",Object.assign({r:e.height},i)):"square"===t?g("polyline",Object.assign({points:`${-e.height},${-e.height} ${-e.height},${e.height} ${e.height},${e.height} ${e.height},${-e.height}`},i)):null},b={image:u,svg:u,text:async({element:e,page:t,store:i})=>{let o={top:0,left:0};e.fill.indexOf("gradient")>=0&&(o=Object.assign(Object.assign({},o),{"background-color":e.fill,"background-image":e.fill,"background-clip":"text","text-fill-color":"transparent","-webkit-background-clip":"text","-webkit-text-fill-color":"transparent"}));const r=e.backgroundPadding*(e.fontSize*e.lineHeight),n=g("div",{style:{position:"absolute",top:-r/2+"px",left:-r/2+"px",display:e.backgroundEnabled?"block":"none",width:e.width+r+"px",height:e.height+r+"px","background-color":e.backgroundColor,"border-radius":e.backgroundCornerRadius*(e.fontSize*e.lineHeight*.5)+"px"}});"middle"===e.verticalAlign?(o.top="50%",o.transform="translateY(-50%)"):"bottom"===e.verticalAlign&&(o.bottom=0);const s=/<[a-z][\s\S]*>/i.test(e.text),a=Object.assign(Object.assign({},o),{position:"absolute",width:e.width+"px",color:e.fill,"white-space":"pre-wrap","font-size":e.fontSize+"px","text-align":e.align,"font-family":e.fontFamily,"text-decoration":e.textDecoration||"none","line-height":e.lineHeight,"letter-spacing":e.letterSpacing+"em","font-style":e.fontStyle,"font-weight":e.fontWeight,"-webkit-text-stroke":`${e.strokeWidth}px ${e.stroke}`,"text-stroke":`${e.strokeWidth}px ${e.stroke}`}),l="el-"+e.id,c=s?{id:l}:{},d=`<style>#${l} {${h.resetStyleContent}}</style>`,p=g("div",Object.assign(Object.assign({style:a},c),{innerHTML:s?`${d}${e.text}`:e.text.split("\n").join("<br />")}));return g("div",{style:{position:"relative",width:"100%",height:"100%"}},n,p)},line:async({element:e,page:t,store:i})=>g("svg",{style:{width:"100%",height:"100%",contain:"layout style size",overflow:"visible"}},g("rect",{x:0,y:0,width:e.width,height:e.height,fill:e.color}),g("g",{transform:`translate(0 ${e.height/2})`},f({element:e,type:e.startHead})),g("g",{transform:`translate(${e.width} ${e.height/2}) rotate(180)`},f({element:e,type:e.endHead}))),figure:async({element:e,page:t,store:i,elementHook:o})=>{const r=(0,l.figureToSvg)(e),n=g("div",{innerHTML:r});return o&&o({dom:n,element:e})||n},group:async({element:e,page:t,store:i,elementHook:o})=>{const r=await Promise.all(e.children.map((e=>m({element:e,page:t,store:i,elementHook:o})))),n=g("div",{style:{"transform-origin":"top left",opacity:e.opacity}},...r);return o&&o({dom:n,element:e})||n},video:async({element:e,page:t,store:i,elementHook:o})=>{const{cropX:r,cropY:n,cropWidth:s,cropHeight:a}=e,l=await(0,d.getVideoSize)(e.src),h=l.width*s,c=l.height*a,p=e.width/e.height;let u,f;p>=h/c?(u=h,f=h/p):(u=c*p,f=c);const b=u/s,m=f/a,y=r*l.width,w=n*l.height,x=Math.max(e.width/l.width,e.height/l.height),$={position:"absolute",width:`${Math.round(b*x)}px`,height:`${Math.round(m*x)}px`,left:-Math.round(y*x)+"px",top:-Math.round(w*x)+"px","object-fit":"fill"},O=`video-${e.id}`,k=g("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden","border-radius":e.cornerRadius+"px",border:e.borderSize?`${e.borderSize}px solid ${e.borderColor}`:"none"}},g("video",{id:O,src:e.src,style:$,controls:!0,playsInline:!0,muted:!0,volume:e.volume}));return o&&o({dom:k,element:e})||k},gif:u};async function m({element:e,page:t,store:i,elementHook:o}){let r=await b[e.type];if(r||(r=()=>g("div",{}),console.error(`HTML export does not support ${e.type} type...`)),!e.visible){return null}const n=await r({element:e,page:t,store:i}),s=[],a=[];if(e.blurEnabled&&s.push(`blur(${e.blurRadius/2}px)`),e.brightnessEnabled&&s.push(`brightness(${100*e.brightness+100}%)`),e.sepiaEnabled&&s.push("sepia()"),e.grayscaleEnabled&&s.push("grayscale()"),e.filters){for(const[h,d]of Object.entries(e.filters)){const e=(0,c.shapeFilterToCSS)(c.Effects[h],d.intensity);e&&(s.push(e.filter),e.html&&a.push(e.html))}}e.shadowEnabled&&s.push(`drop-shadow(${e.shadowOffsetX}px ${e.shadowOffsetY}px ${e.shadowBlur}px ${e.shadowColor})`);const l=g("div",{id:e.id,style:{position:"absolute",left:e.x+"px",top:e.y+"px",width:e.width+"px",height:e.height+"px",transform:`rotate(${e.rotation}deg)`,"transform-origin":"top left",opacity:e.opacity,display:e.visible&&e.showInExport?"block":"none",filter:s.join(" ")||"none"}},n,...a);return o&&o({dom:l,element:e})||l}async function y({json:e,elementHook:t}){const i=await Promise.all(e.pages.map((i=>async function({page:e,store:t,elementHook:i}){const o=await Promise.all(e.children.map((o=>m({element:o,page:e,store:t,elementHook:i})))),r="auto"===e.width?t.width:e.width,s="auto"===e.height?t.height:e.height;let l={};if(e.background.indexOf("url")>=0||e.background.indexOf("http")>=0||e.background.indexOf(".jpg")>=0||e.background.indexOf(".png")>=0||e.background.indexOf(".jpeg")>=0){const{width:i,height:r}=await(0,a.loadImage)(e.background),s=await u({element:Object.assign({x:0,y:0,width:i,height:r,src:e.background,cornerRadius:0},(0,n.getCrop)({width:i,height:r},{width:i,height:r})),page:e,store:t});o.unshift(s)}else{l=Object.assign(Object.assign({},l),{"background-color":e.background})}return g("div",{className:"page",id:e.id,style:Object.assign(Object.assign({},l),{width:r+"px",height:s+"px",overflow:"hidden",position:"relative"})},...o)}({page:i,store:e,elementHook:t})))),o=[];e.pages.forEach((e=>{e.children.forEach((e=>{"text"===e.type&&-1===o.indexOf(e.fontFamily)&&o.push(e.fontFamily)}))}));const r=o.map((t=>e.fonts.find((e=>e.fontFamily===t))?g("style",{},""):g("link",{href:(0,p.getGoogleFontsUrl)(t),rel:"stylesheet"})));return g("div",{className:"design"},...r,...i)}const w=({dom:e})=>{if("string"==typeof e){return e}if(!e){return""}const t=e.props,{innerHTML:i}=t,o=r(t,["innerHTML"]);return`<${e.type} ${Object.keys(o).map((t=>((e,t)=>"object"==typeof t?`${e}="${Object.keys(t).map((e=>`${e}:${t[e]};`)).join(" ")}"`:`${e}="${t}"`)(t,e.props[t]))).join(" ")}>${i||e.children.map((e=>w({dom:e}))).join("")}</${e.type}>`};