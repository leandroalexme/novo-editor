var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.VideoToolbar=exports.VideoClip=exports.VideoTrim=void 0;const t=e(require("react")),o=require("mobx-react-lite"),i=require("./element-container"),r=require("@blueprintjs/core"),n=require("./animations-picker"),a=require("../utils/flags"),l=require("../utils/video"),d=require("../utils/l10n"),s=require("@blueprintjs/icons");exports.VideoTrim=(0,o.observer)((({store:e,components:o,element:i})=>{const n=t.default.useRef(null),[a,d]=t.default.useState([]);t.default.useEffect((()=>{d([])}),[i.src]);const u=(e,t)=>{e.preventDefault();const o=e=>{e.preventDefault();const{clientX:o}=e,{left:r,width:a}=n.current.getBoundingClientRect(),{src:l}=i,d=(o-r)/a;"start"===t?i.set({startTime:Math.min(i.endTime,Math.max(0,d))}):"end"===t&&i.set({endTime:Math.min(1,Math.max(i.startTime,d))})};window.addEventListener("mousemove",o),window.addEventListener("mouseup",(()=>{window.removeEventListener("mousemove",o)}))};return t.default.createElement(r.Popover,{position:"bottom",onOpened:async()=>{if(!i.src){return}if(a.length){return}const{width:e,height:t}=await(0,l.getVideoSize)(i.src),o=e/t,{src:r}=i,s=n.current.offsetHeight,u=n.current.offsetWidth,c=s*o,m=Math.ceil(u/c),p=await(0,l.getVideoDuration)(r),f=document.createElement("video");f.crossOrigin="anonymous",f.src=r;const h=document.createElement("canvas");h.width=480;try{await new Promise(((e,t)=>{f.addEventListener("loadeddata",(()=>{const t=f.videoWidth/f.videoHeight;h.height=480/t,e()})),f.addEventListener("error",t)})),d([]);for(let e=0;e<m;e++){const t=e*p/m,o=await(0,l.getVideoObjectPreview)(f,h,t);d((e=>e.concat(o)))}}catch(v){console.error("Error generating previews:",v)}},content:t.default.createElement(r.Navbar,{style:{boxShadow:"none",backgroundColor:"transparent",width:"calc(100vw - 300px)"}},t.default.createElement(r.NavbarGroup,null,t.default.createElement(r.NumericInput,{style:{width:"80px"},value:parseFloat((i.duration*(i.endTime-i.startTime)/1e3).toFixed(2)),minorStepSize:.01,stepSize:.1,buttonPosition:"none",readOnly:!0}),t.default.createElement("div",{style:{width:"calc(100vw - 420px)",height:"30px",display:"flex",position:"relative",overflow:"hidden",marginLeft:"10px"},ref:n},a.map(((e,o)=>t.default.createElement("img",{key:o,src:e,style:{width:"auto",height:"100%",objectFit:"cover"}}))),t.default.createElement("div",{style:{position:"absolute",top:"0",left:0,width:100*i.startTime+"%",height:"30px",backgroundColor:"rgb(0, 0, 0, 0.5)"}}),t.default.createElement("div",{style:{position:"absolute",top:"0",right:"0%",width:100-100*i.endTime+"%",height:"30px",backgroundColor:"rgb(0, 0, 0, 0.5)"}}),t.default.createElement("div",{style:{position:"absolute",top:"0",left:100*i.startTime+"%",width:"10px",height:"30px",borderRadius:"0px",backgroundColor:"rgb(0, 161, 255, 0.9)",cursor:"ew-resize"},onMouseDown:e=>{u(e,"start")}}),t.default.createElement("div",{style:{position:"absolute",top:"0",right:100-100*i.endTime+"%",width:"10px",height:"30px",borderRadius:"0px",backgroundColor:"rgb(0, 161, 255, 0.9)",cursor:"ew-resize"},onMouseDown:e=>{u(e,"end")}}))))},t.default.createElement(r.Button,{icon:t.default.createElement(s.Cut,null),minimal:!0},"Trim"))}));const u=(0,o.observer)((({element:e})=>{const o=Math.round(100*e.volume),i=t=>{e.set({volume:t/100})};return t.default.createElement(r.Popover,{position:"bottom",content:t.default.createElement("div",{style:{padding:"10px",width:"250px"}},t.default.createElement("div",{style:{display:"flex",width:"100%",justifyContent:"space-between"}},t.default.createElement("div",{style:{paddingTop:"7px",paddingLeft:"10px",width:"calc(100% - 80px)"}},t.default.createElement(r.Slider,{value:o,onChange:e=>{i(e)},min:0,max:100,labelStepSize:50,showTrackFill:!1,labelRenderer:!1})),t.default.createElement(r.NumericInput,{value:o,onValueChange:e=>{var t;i((t=e,Math.max(0,Math.min(100,t))))},buttonPosition:"none",style:{width:"50px",padding:"0 5px",marginLeft:"10px"},min:0,max:100})))},t.default.createElement(r.Button,{icon:t.default.createElement(s.VolumeUp,null),minimal:!0}))}));exports.VideoClip=(0,o.observer)((({element:e,store:o})=>e.contentEditable?e.clipSrc?t.default.createElement(r.Button,{text:(0,d.t)("toolbar.removeClip"),minimal:!0,onClickCapture:t=>{e.set({clipSrc:""})}}):t.default.createElement(r.Button,{minimal:!0,text:(0,d.t)("toolbar.clip"),onClickCapture:e=>{e.stopPropagation(),o.openSidePanel("image-clip")}}):null));const c={VideoTrim:exports.VideoTrim,VideoAnimations:n.AnimationsPicker,VideoVolume:u,VideoClip:exports.VideoClip};exports.VideoToolbar=(0,o.observer)((({store:e,components:o})=>{const r=e.selectedElements,n=["VideoTrim","VideoVolume","VideoClip",a.flags.animationsEnabled&&"VideoAnimations"].filter((e=>!!e)),l=(0,i.extendToolbar)({type:"video",usedItems:n,components:o});return t.default.createElement(i.ElementContainer,{items:l,itemRender:i=>{const n=o[i]||c[i];return t.default.createElement(n,{elements:r,element:r[0],store:e,key:i})}})})),exports.default=exports.VideoToolbar;