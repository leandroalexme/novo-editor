var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ImageToolbar=exports.ImageRemoveClip=exports.ImageCrop=exports.ImageClip=exports.ImageFitToBackground=exports.ImageRemoveBackground=void 0;const t=e(require("react")),o=require("mobx-react-lite"),r=require("@blueprintjs/core"),a=require("./element-container"),l=require("@blueprintjs/icons"),n=e(require("./filters-picker")),i=require("./animations-picker"),m=e(require("./flip-button")),c=require("../utils/flags"),u=require("./image-remove-background-button");var p=require("./image-remove-background-button");Object.defineProperty(exports,"ImageRemoveBackground",{enumerable:!0,get:function(){return p.ImageRemoveBackground}});const s=require("../utils/image"),g=require("../utils/l10n");exports.ImageFitToBackground=({element:e})=>t.default.createElement(r.Button,{text:(0,g.t)("toolbar.fitToBackground"),minimal:!0,onClick:async()=>{const{page:t}=e,o=t.computedWidth+2*t.bleed,r=t.computedHeight+2*t.bleed,a=await(0,s.getImageSize)(e.src),l=e.stretchEnabled?{cropX:0,cropY:0,cropWidth:1,cropHeight:1}:(0,s.getCrop)({width:o,height:r},a);e.set(Object.assign({x:-t.bleed,y:-t.bleed,width:o,height:r,rotation:0},l))}}),exports.ImageClip=(0,o.observer)((({element:e,store:o,elements:a})=>e.contentEditable?e.clipSrc?t.default.createElement(r.Button,{text:(0,g.t)("toolbar.removeClip"),minimal:!0,onClickCapture:e=>{a.forEach((e=>{e.set({clipSrc:""})}))}}):t.default.createElement(r.Button,{minimal:!0,text:(0,g.t)("toolbar.clip"),onClickCapture:e=>{e.stopPropagation(),o.openSidePanel("image-clip")}}):null)),exports.ImageCrop=(0,o.observer)((({element:e,store:o})=>e.contentEditable?e.stretchEnabled?null:t.default.createElement(r.Tooltip,{content:(0,g.t)("toolbar.crop"),position:"bottom"},t.default.createElement(r.Button,{minimal:!0,icon:t.default.createElement(l.Crop,null),onClickCapture:t=>{t.stopPropagation(),e.toggleCropMode(!0)}})):null)),exports.ImageRemoveClip=(0,o.observer)((({element:e,store:o})=>e.clipSrc?t.default.createElement(r.Button,{text:(0,g.t)("toolbar.removeClip"),minimal:!0,onClickCapture:t=>{e.set({clipSrc:""})}}):null));const d={ImageFlip:m.default,ImageFilters:n.default,ImageFitToBackground:exports.ImageFitToBackground,ImageCrop:exports.ImageCrop,ImageClip:exports.ImageClip,ImageRemoveBackground:u.ImageRemoveBackground,ImageAnimations:i.AnimationsPicker};exports.ImageToolbar=(0,o.observer)((({store:e,components:o})=>{const n=e.selectedElements[0],i=n._cropModeEnabled,m=t.default.useRef({});t.default.useEffect((()=>{i&&(m.current={x:n.x,y:n.y,width:n.width,height:n.height,cropX:n.cropX,cropY:n.cropY,cropWidth:n.cropWidth,cropHeight:n.cropHeight})}),[i]);const u=["ImageFlip","ImageFilters","ImageFitToBackground","ImageClip","ImageCrop",c.flags.animationsEnabled&&"ImageAnimations",c.flags.removeBackgroundEnabled&&"ImageRemoveBackground"],p=(0,a.extendToolbar)({type:"image",usedItems:u,components:o});return t.default.createElement(t.default.Fragment,null,!i&&t.default.createElement(a.ElementContainer,{items:p,itemRender:r=>{const a=o[r]||d[r];return t.default.createElement(a,{element:n,store:e,key:r,elements:e.selectedElements})}}),i&&t.default.createElement(r.Navbar.Group,null,t.default.createElement(r.Button,{text:(0,g.t)("toolbar.cropDone"),minimal:!0,icon:t.default.createElement(l.Tick,null),onClickCapture:e=>{n.toggleCropMode(!1)}}),t.default.createElement(r.Button,{text:(0,g.t)("toolbar.cropCancel"),minimal:!0,icon:t.default.createElement(l.Cross,null),onClickCapture:e=>{n.set(Object.assign({},m.current)),n.toggleCropMode(!1)}})))})),exports.default=exports.ImageToolbar;