var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Sketch=void 0;const t=e(require("react")),r=e(require("reactcss")),a=e(require("lodash/merge")),n=require("@blueprintjs/core"),o=e(require("@meronex/icons/cg/CgColorPicker")),l=e(require("konva")),i=require("react-color/lib/components/common"),s=e(require("react-color/lib/components/sketch/SketchFields")),d=e(require("react-color/lib/components/sketch/SketchPresetColors")),c=e=>{const r=t.default.useRef(e);return r.current=e,t.default.useCallback(((...e)=>r.current(...e)),[])};exports.Sketch=({width:e=200,rgb:u,hex:p,hsv:h,hsl:f,onChange:g,onSwatchHover:m,disableAlpha:x=!1,presetColors:b=["#D0021B","#F5A623","#F8E71C","#8B572A","#7ED321","#417505","#BD10E0","#9013FE","#4A90E2","#50E3C2","#B8E986","#000000","#4A4A4A","#9B9B9B","#FFFFFF"],renderers:v,styles:E={},className:w=""})=>{const C=(0,r.default)((0,a.default)({default:Object.assign({picker:{width:e,padding:"10px 10px 0",boxSizing:"initial",background:"#fff",borderRadius:"4px",boxShadow:"0 0 0 1px rgba(0,0,0,.15), 0 8px 16px rgba(0,0,0,.15)"},saturation:{width:"100%",paddingBottom:"75%",position:"relative",overflow:"hidden"},Saturation:{radius:"3px",shadow:"inset 0 0 0 1px rgba(0,0,0,.15), inset 0 0 4px rgba(0,0,0,.25)"},controls:{display:"flex"},sliders:{padding:"4px 0",flex:"1"},color:{width:"24px",height:"24px",position:"relative",marginTop:"4px",marginLeft:"4px",borderRadius:"3px"},activeColor:{absolute:"0px 0px 0px 0px",borderRadius:"2px",background:`rgba(${u.r},${u.g},${u.b},${u.a})`,boxShadow:"inset 0 0 0 1px rgba(0,0,0,.15), inset 0 0 4px rgba(0,0,0,.25)"},hue:{position:"relative",height:"10px",overflow:"hidden"},Hue:{radius:"2px",shadow:"inset 0 0 0 1px rgba(0,0,0,.15), inset 0 0 4px rgba(0,0,0,.25)"},alpha:{position:"relative",height:"10px",marginTop:"4px",overflow:"hidden"},Alpha:{radius:"2px",shadow:"inset 0 0 0 1px rgba(0,0,0,.15), inset 0 0 4px rgba(0,0,0,.25)"}},E),disableAlpha:{color:{height:"10px"},hue:{height:"10px"},alpha:{display:"none"}}},E),{disableAlpha:x}),[k,y]=t.default.useState(!1),A=t.default.useRef(null),S=c((e=>{var t;if(k){const r=null===(t=A.current)||void 0===t?void 0:t.fill();r&&g(l.default.Util.colorToRGBA(r)),F(),function(e){let t=e.target;for(;t;){if(t.classList.contains("color-picker-button")){return!0}t=t.parentElement}return!1}(e)||y(!1),e.stopPropagation(),e.stopImmediatePropagation()}})),B=c((e=>{if(!k){return}const t=l.default.stages.find((t=>{const r=t.getContent().parentElement.parentElement.getBoundingClientRect();return r.left<e.clientX&&r.left+r.width>e.clientX&&r.top<e.clientY&&r.top+r.height>e.clientY}));if(!t){return void F()}const r=t.getContent().getBoundingClientRect(),a=e.clientX-r.left,n=e.clientY-r.top,o=t.children[0],i=o.getNativeCanvasElement(),s=o.getCanvas().getPixelRatio(),{data:d}=i.getContext("2d").getImageData(a*s,n*s,1,1),c=t.findOne(".line-guides");c.findOne(".picker")||(A.current&&A.current.destroy(),A.current=new l.default.Circle({name:"picker",radius:14,stroke:"black",strokeWidth:1}),c.add(A.current)),A.current.setAbsolutePosition({x:a-15,y:n-15}),A.current.fill("rgb("+d[0]+","+d[1]+","+d[2]+")")}));t.default.useEffect((()=>(window.addEventListener("mousemove",B),window.addEventListener("mousedown",S,!0),window.addEventListener("touchstart",S,!0),()=>{window.removeEventListener("mousemove",B),window.removeEventListener("mousedown",S,!0),window.removeEventListener("touchstart",S,!0),F()})),[]),t.default.useEffect((()=>{k||F()}),[k]),t.default.useEffect((()=>(k&&(document.body.style.cursor="crosshair"),()=>{document.body.style.cursor="default"})),[k]);const F=c((()=>{A.current&&(A.current.destroy(),A.current=null)}));return t.default.createElement("div",{style:C.picker,className:`sketch-picker ${w}`},t.default.createElement("div",{style:C.saturation},t.default.createElement(i.Saturation,{style:C.Saturation,hsl:f,hsv:h,onChange:g})),t.default.createElement("div",{style:C.controls,className:"flexbox-fix"},t.default.createElement("div",{style:C.sliders},t.default.createElement("div",{style:C.hue},t.default.createElement(i.Hue,{style:C.Hue,hsl:f,onChange:g})),t.default.createElement("div",{style:C.alpha},t.default.createElement(i.Alpha,{style:C.Alpha,rgb:u,hsl:f,renderers:v,onChange:g}))),t.default.createElement("div",{style:C.color},t.default.createElement(i.Checkboard,{size:8,white:"transparent",grey:"rgba(0,0,0,.08)"}),t.default.createElement("div",{style:C.activeColor})),t.default.createElement("div",{style:C.color},t.default.createElement(n.Button,{icon:t.default.createElement(o.default,null),className:"color-picker-button",minimal:!0,style:{width:"24px",height:"24px",minWidth:"24px",minHeight:"24px",padding:0,margin:0},active:k,onClickCapture:e=>{y((e=>!e)),e.stopPropagation()}}))),t.default.createElement(s.default,{rgb:u,hsl:f,hex:p,onChange:g,disableAlpha:x}),t.default.createElement(d.default,{colors:b,onClick:g,onSwatchHover:m}))},exports.default=(0,i.ColorWrap)(exports.Sketch);