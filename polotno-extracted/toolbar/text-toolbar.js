var e=this&&this.__rest||function(e,t){var n={};for(var l in e){Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l])}if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(l=Object.getOwnPropertySymbols(e);a<l.length;a++){t.indexOf(l[a])<0&&Object.prototype.propertyIsEnumerable.call(e,l[a])&&(n[l[a]]=e[l[a]])}}return n},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextToolbar=exports.TextSpacing=exports.NumberInput=exports.TextFill=exports.TextFontVariant=exports.ALIGN_OPTIONS=exports.TextFontSize=exports.TextFontFamily=exports.fetcher=void 0;const n=t(require("react")),l=require("mobx-react-lite"),a=require("@blueprintjs/core"),i=require("@blueprintjs/core"),r=require("react-window"),o=t(require("swr")),s=require("@blueprintjs/icons"),u=require("../utils/fonts"),c=require("../utils/api"),d=t(require("./color-picker")),f=t(require("./filters-picker")),m=require("./animations-picker"),p=require("./element-container"),x=require("./text-ai-write"),h=t(require("@meronex/icons/mdc/MdcFormatLineSpacing")),g=t(require("../utils/styled")),E=t(require("@meronex/icons/mdc/MdcFormatVerticalAlignTop")),y=t(require("@meronex/icons/mdc/MdcFormatVerticalAlignCenter")),F=t(require("@meronex/icons/mdc/MdcFormatVerticalAlignBottom")),b=require("../utils/l10n"),v=require("../utils/flags"),T=(0,g.default)("img")`
  height: 20px;

  .bp5-dark & {
    filter: invert(1);
  }
`,S=(0,u.getFontsList)(),C=({fontFamily:e,handleClick:t,modifiers:l,store:i,isCustom:r})=>{const[o,s]=n.default.useState(!r);if(n.default.useEffect((()=>{o||i.loadFont(e)}),[e,o]),"_divider"===e){return n.default.createElement("div",{style:{paddingTop:"10px"}},n.default.createElement(a.MenuDivider,null))}const u=o?n.default.createElement(T,{src:(0,c.getGoogleFontImage)(e),alt:e,onError:()=>{s(!1)}}):e;return n.default.createElement(a.MenuItem,{text:u,active:l.active,disabled:l.disabled,onClick:t,style:{fontFamily:'"'+e+'"'}})},O=({onChange:e,defaultValue:t})=>{const l=n.default.useRef(null);return n.default.useEffect((()=>{l.current&&l.current.focus()}),[]),n.default.createElement(a.InputGroup,{leftIcon:n.default.createElement(s.Search,null),inputRef:l,defaultValue:t,onChange:t=>e(t.target.value)})},I=({store:e,fonts:t,activeFont:l,activeFontLabel:o,onFontSelect:c})=>{const[d,f]=n.default.useState(""),m=t.filter((e=>e.toLowerCase().indexOf(d.toLowerCase())>=0));return n.default.createElement(i.Popover,{content:n.default.createElement("div",null,n.default.createElement(O,{onChange:e=>f(e),defaultValue:d}),n.default.createElement("div",{style:{paddingTop:"5px"}},n.default.createElement(r.FixedSizeList,{innerElementType:n.default.forwardRef(((e,t)=>n.default.createElement(a.Menu,Object.assign({ref:t},e)))),height:Math.min(400,30*m.length)+10,width:210,itemCount:m.length,itemSize:30,children:({index:t,style:a})=>{const i=m[t];return n.default.createElement("div",{style:a},n.default.createElement(C,{key:i,fontFamily:i,modifiers:{active:l===i},handleClick:()=>c(i),store:e,isCustom:e.fonts.find((e=>e.fontFamily===i))||u.globalFonts.find((e=>e.fontFamily===i))}))}})))},n.default.createElement(a.Button,{text:o,rightIcon:n.default.createElement(s.CaretDown,null),minimal:!0,style:{marginRight:"5px",fontFamily:'"'+l+'"',overflow:"hidden",whiteSpace:"nowrap",maxHeight:"30px"}}))},N={};exports.fetcher=e=>N[e]?Promise.resolve(N[e]):fetch(e).then((e=>e.json())).then((t=>(N[e]=t,t))),exports.TextFontFamily=(0,l.observer)((({elements:e,store:t})=>{const{data:l,mutate:a}=(0,o.default)((0,c.getGoogleFontsListAPI)(),exports.fetcher,{isPaused:()=>(0,u.isGoogleFontChanged)(),fallbackData:[]});n.default.useEffect((()=>{a()}),[(0,u.isGoogleFontChanged)()]);const i=t.fonts.concat(u.globalFonts).map((e=>e.fontFamily)).concat((null==l?void 0:l.length)&&!(0,u.isGoogleFontChanged)()?l:S);let r=e[0].fontFamily;r.length>15&&(r=r.slice(0,15)+"...");const s=[];t.find((e=>("text"===e.type&&s.push(e.fontFamily),!1)));const d=[...new Set(s.concat("_divider").concat(i))];return n.default.createElement(I,{fonts:d,activeFont:e[0].fontFamily,activeFontLabel:r,store:t,onFontSelect:n=>{t.history.transaction((()=>{e.forEach((e=>{e.set({fontFamily:n})}))}))}})})),exports.TextFontSize=(0,l.observer)((({elements:e,store:t})=>n.default.createElement(a.NumericInput,{onValueChange:n=>{Number.isNaN(n)||t.history.transaction((()=>{e.forEach((e=>{e.set({fontSize:n,width:Math.max(n,e.width)})}))}))},value:Math.round(e[0].fontSize),style:{width:"50px"},min:5,max:4*t.height}))),exports.ALIGN_OPTIONS=["left","center","right","justify"];const w=["top","middle","bottom"],A={top:n.default.createElement("span",{className:"bp5-icon"},n.default.createElement(E.default,null)),middle:n.default.createElement("span",{className:"bp5-icon"},n.default.createElement(y.default,null)),bottom:n.default.createElement("span",{className:"bp5-icon"},n.default.createElement(F.default,null))};exports.TextFontVariant=(0,l.observer)((({elements:e,store:t})=>{const l=e[0];return n.default.createElement(a.ButtonGroup,null,n.default.createElement(a.Button,{minimal:!0,icon:"left"===l.align?n.default.createElement(s.AlignLeft,null):"center"===l.align?n.default.createElement(s.AlignCenter,null):"right"===l.align?n.default.createElement(s.AlignRight,null):n.default.createElement(s.AlignJustify,null),onClick:()=>{const n=(exports.ALIGN_OPTIONS.indexOf(l.align)+1+exports.ALIGN_OPTIONS.length)%exports.ALIGN_OPTIONS.length,a=exports.ALIGN_OPTIONS[n];t.history.transaction((()=>{e.forEach((e=>{e.set({align:a})}))}))}}),v.flags.textVerticalResizeEnabled&&n.default.createElement(a.Button,{minimal:!0,icon:A[l.verticalAlign],onClick:()=>{const n=(w.indexOf(l.verticalAlign)+1+w.length)%w.length,a=w[n];t.history.transaction((()=>{e.forEach((e=>{e.set({verticalAlign:a})}))}))}}),n.default.createElement(a.Button,{minimal:!0,icon:n.default.createElement(s.Bold,null),active:"bold"===l.fontWeight||"700"===l.fontWeight,onClick:()=>{const n="bold"===l.fontWeight||"700"===l.fontWeight;t.history.transaction((()=>{e.forEach((e=>{n?e.set({fontWeight:"normal"}):e.set({fontWeight:"bold"})}))}))}}),n.default.createElement(a.Button,{minimal:!0,icon:n.default.createElement(s.Italic,null),active:"italic"===l.fontStyle,onClick:()=>{const n="italic"===l.fontStyle;t.history.transaction((()=>{e.forEach((e=>{n?e.set({fontStyle:"normal"}):e.set({fontStyle:"italic"})}))}))}}),n.default.createElement(a.Button,{minimal:!0,icon:n.default.createElement(s.Underline,null),active:l.textDecoration.indexOf("underline")>=0,onClick:()=>{let n=l.textDecoration.split(" ");n.indexOf("underline")>=0?n=n.filter((e=>"underline"!==e)):n.push("underline"),t.history.transaction((()=>{e.forEach((e=>{e.set({textDecoration:n.join(" ")})}))}))}}),n.default.createElement(a.Button,{minimal:!0,icon:n.default.createElement(s.Strikethrough,null),active:l.textDecoration.indexOf("line-through")>=0,onClick:()=>{let n=l.textDecoration.split(" ");n.indexOf("line-through")>=0?n=n.filter((e=>"line-through"!==e)):n.push("line-through"),t.history.transaction((()=>{e.forEach((e=>{e.set({textDecoration:n.join(" ")})}))}))}}))})),exports.TextFill=(0,l.observer)((({elements:e,store:t})=>n.default.createElement(d.default,{value:e[0].fill,style:{marginRight:"5px"},gradientEnabled:!0,onChange:n=>t.history.transaction((()=>{e.forEach((e=>{e.set({fill:n})}))})),store:t}))),exports.NumberInput=t=>{var{value:l,onValueChange:i}=t,r=e(t,["value","onValueChange"]);const[o,s]=n.default.useState(l.toString());return n.default.useEffect((()=>{s(l.toString())}),[l]),n.default.createElement(a.NumericInput,Object.assign({value:o,onValueChange:(e,t)=>{s(t),Number.isNaN(e)||i(e)}},r))},exports.TextSpacing=(0,l.observer)((({elements:e,store:t})=>{const l=e[0],r=n=>{t.history.transaction((()=>{e.forEach((e=>{e.set(n)}))}))},o="number"==typeof l.lineHeight?100*l.lineHeight:120;return n.default.createElement(i.Popover,{content:n.default.createElement("div",{style:{padding:"15px",width:"230px"}},n.default.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingTop:"5px",paddingBottom:"5px"}},n.default.createElement("div",null,(0,b.t)("toolbar.lineHeight")),n.default.createElement("div",null,n.default.createElement(exports.NumberInput,{value:Math.round(o),onValueChange:e=>{r({lineHeight:e/100})},style:{width:"50px"},min:50,max:250,buttonPosition:"none"}))),n.default.createElement(a.Slider,{value:Math.round(o),onChange:e=>{r({lineHeight:e/100})},min:50,max:250,stepSize:1,showTrackFill:!1,labelRenderer:!1}),n.default.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingTop:"5px",paddingBottom:"5px"}},n.default.createElement("div",null,(0,b.t)("toolbar.letterSpacing")),n.default.createElement("div",null,n.default.createElement(exports.NumberInput,{value:Math.round(100*l.letterSpacing),onValueChange:e=>{r({letterSpacing:e/100})},style:{width:"50px"},min:-50,max:250,buttonPosition:"none"}))),n.default.createElement(a.Slider,{value:Math.round(100*l.letterSpacing),onChange:e=>{r({letterSpacing:e/100})},min:-50,max:250,stepSize:1,showTrackFill:!1,labelRenderer:!1})),position:a.Position.BOTTOM},n.default.createElement(a.Button,{icon:n.default.createElement(h.default,{className:"bp5-icon",style:{fontSize:"20px"}}),minimal:!0}))}));const q={TextFontFamily:exports.TextFontFamily,TextFontSize:exports.TextFontSize,TextFontVariant:exports.TextFontVariant,TextFill:exports.TextFill,TextSpacing:exports.TextSpacing,TextAiWrite:x.TextAiWrite,TextFilters:f.default,TextAnimations:m.AnimationsPicker};exports.TextToolbar=(0,l.observer)((({store:e,components:t})=>{const l=e.selectedElements,a=["TextFill","TextFontFamily","TextFontSize","TextFontVariant","TextSpacing","TextFilters",v.flags.animationsEnabled&&"TextAnimations","TextAiWrite"],i=(0,p.extendToolbar)({type:"text",usedItems:a,components:t});return n.default.createElement(p.ElementContainer,{items:i,itemRender:a=>{const i=t[a]||q[a];return n.default.createElement(i,{elements:l,element:l[0],store:e,key:a})}})})),exports.default=exports.TextToolbar;