var e=this&&this.__rest||function(e,t){var r={};for(var o in e){Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o])}if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++){t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(r[o[n]]=e[o[n]])}}return r},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ColorPicker=exports.getUsedColors=exports.DEFAULT_COLORS=void 0,exports.setColorsPresetFunc=function(e){b=e};const r=t(require("react")),o=require("@blueprintjs/core"),n=require("@blueprintjs/core"),l=require("mobx-react-lite"),a=require("../utils/l10n"),s=t(require("./sketch")),i=t(require("../utils/styled")),d=require("../utils/gradient"),u=require("../utils/svg");exports.DEFAULT_COLORS=["#D0021B","#F5A623","#F8E71C","#8B572A","#7ED321","#417505","#BD10E0","#9013FE","#4A90E2","#50E3C2","#B8E986","#000000","#4A4A4A","#9B9B9B","#FFFFFF"].reverse(),exports.getUsedColors=e=>{const t=[];e.pages.forEach((e=>{e.children.forEach((e=>{e.shadowEnabled&&t.push(e.shadowColor),"text"===e.type&&(t.push(e.fill),e.backgroundEnabled&&t.push(e.backgroundColor),e.strokeWidth&&t.push(e.stroke)),"svg"===e.type&&t.push(...e.colorsReplace.values()),"figure"===e.type&&(t.push(e.fill),e.strokeWidth&&t.push(e.stroke)),"line"===e.type&&t.push(e.color)}))}));const r=[];return t.forEach((e=>{if((0,d.isGradient)(e)){const{stops:t}=(0,d.parseColor)(e);r.push(...t.map((e=>e.color)))}else{r.push(e)}})),[...new Set(r)]};const c=(0,i.default)("div")`
  & .sketch-picker {
    padding: 0px !important;
    box-shadow: none !important;
    background: none !important;
  }

  & .flexbox-fix {
    border-top: none !important;
  }

  .bp5-dark & .sketch-picker {
    background-color: #394b59;
  }

  .bp5-dark & .sketch-picker label {
    color: #f5f8fa !important;
  }
`,p=t=>{var{style:o,color:n,onChange:l}=t,a=e(t,["style","color","onChange"]);const[i,d]=r.default.useState(n);r.default.useEffect((()=>{d(n)}),[n]);const u=r.default.useRef(),p=r.default.useRef();return r.default.createElement(c,{style:o,onMouseDown:e=>{"INPUT"!==e.target.tagName&&e.preventDefault()}},r.default.createElement(s.default,Object.assign({color:i},a,{onChange:e=>{const{r:t,g:r,b:o,a:n}=e.rgb,a=`rgba(${t},${r},${o},${n})`;d(a),p.current=a,u.current||(u.current=window.setTimeout((()=>{u.current=0,l(a)}),50))}})))},f=e=>e.map((e=>`${e.color} ${100*e.offset}%`)).join(","),g=({value:e,onChange:t,store:l,preset:s})=>{const{rotation:i,stops:u}=(0,d.parseColor)(e),c=r.default.useRef(u);c.current=u;const g=r.default.useRef(i);g.current=i;const[h,b]=r.default.useState(0),x=r.default.useRef(null),E=r.default.useRef(!1),v=()=>{E.current=!0};return r.default.useEffect((()=>{const e=e=>{if(E.current){const r=x.current.getBoundingClientRect(),o=e.clientX-r.left,n=o/r.width,l=n<-.5||n>1.5;if(u.length>2&&l){return b(0),E.current=!1,c.current.splice(h,1),void t(`linear-gradient(${g.current}deg, ${f(c.current)})`)}const a=Math.min(1,Math.max(0,o/r.width)),s=[...c.current];s[h].offset=a,t(`linear-gradient(${g.current}deg, ${f(s)})`)}},r=()=>{E.current=!1};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",r),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",r)}}),[h,c]),r.default.createElement("div",null,r.default.createElement("div",{style:{width:"calc(100% - 35px)",height:"60px",position:"relative"}},r.default.createElement("div",{ref:x,style:{position:"absolute",top:0,left:0,width:"100%",marginLeft:"15px",height:"100%",zIndex:0},onMouseDown:e=>{const r=e.currentTarget.getBoundingClientRect(),o=e.clientX-r.left,n=Math.min(1,Math.max(0,o/r.width)),l=u[0].color;u.push({color:l,offset:n}),u.sort(((e,t)=>e.offset-t.offset));const a=u.findIndex((e=>e.offset===n));b(a),v(),t(`linear-gradient(${i}deg, ${f(u)})`)}}),u.map((({offset:e,color:t},o)=>r.default.createElement("div",{key:o,style:{position:"absolute",top:"10px",left:100*e+"%",border:o===h?"2px solid rgb(0, 161, 255)":"2px solid rgb(0, 0, 0, 0)",padding:"2px"},onMouseDown:e=>{e.stopPropagation(),b(o),v()}},r.default.createElement(m,{background:t,style:{margin:0}}))))),r.default.createElement("div",{style:{width:"calc(100% - 30px)",height:"10px",marginLeft:"15px",background:`linear-gradient(90deg,${f(u)})`}}),r.default.createElement("div",{style:{padding:"10px"}},r.default.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingTop:"5px",paddingBottom:"5px"}},r.default.createElement("div",null,(0,a.t)("toolbar.colorPicker.angle")),r.default.createElement("div",null,r.default.createElement(o.NumericInput,{value:i,onValueChange:e=>{const r=Math.min(360,Math.max(0,e));t(`linear-gradient(${r}deg,${f(u)})`)},buttonPosition:"none",style:{width:"50px"},min:0,max:360}))),r.default.createElement(n.Slider,{min:0,max:360,value:i,showTrackFill:!1,labelRenderer:!1,onChange:e=>{t(`linear-gradient(${e}deg,${f(u)})`)}})),r.default.createElement(p,{color:u[h].color,presetColors:s,onChange:e=>{const r=[...u];r[h].color=e,t(`linear-gradient(${i}deg, ${f(r)})`)}}))},h=(0,l.observer)((({value:e,onChange:t,preset:n,store:l})=>{const[s,i]=r.default.useState((0,d.isGradient)(e)?"gradient":"solid");return r.default.createElement("div",{style:{padding:"5px"}},r.default.createElement(o.Tabs,{id:"TabsExample",selectedTabId:s,onChange:e=>i(e)},r.default.createElement(o.Tab,{id:"solid",title:(0,a.t)("toolbar.colorPicker.solid"),panel:r.default.createElement(p,{color:e,onChange:t,presetColors:n,style:{padding:"0"}})}),r.default.createElement(o.Tab,{id:"gradient",title:(0,a.t)("toolbar.colorPicker.linear"),panel:r.default.createElement(g,{value:e,onChange:t,store:l,preset:n}),panelClassName:"ember-panel"})))})),m=t=>{var{size:o=30,background:n,style:l={},children:a=null}=t,s=e(t,["size","background","style","children"]);return r.default.createElement("div",Object.assign({onMouseDown:e=>e.preventDefault(),style:Object.assign({width:o+"px",height:o+"px",background:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='15' height='15' viewBox='0 0 8 8'%3E%3Cg fill='rgba(112, 112, 116, 1)' fill-opacity='1'%3E%3Cpath fill-rule='evenodd' d='M0 0h4v4H0V0zm4 4h4v4H4V4z'/%3E%3C/g%3E%3C/svg%3E\")",borderRadius:"2px",boxShadow:"0 0 2px grey",marginBottom:"-4px"},l)},s),r.default.createElement("div",{style:{width:o+"px",height:o+"px",background:n}},a))};let b=e=>{const t=(0,exports.getUsedColors)(e).slice(0,8).filter((e=>!exports.DEFAULT_COLORS.find((t=>(0,u.sameColors)(t,e)))));return t.concat(exports.DEFAULT_COLORS.slice(0,16-t.length).reverse())};exports.ColorPicker=({value:e,onChange:t,size:n,store:l,gradientEnabled:a,children:s,style:i,position:d="auto",onOpen:u,onClose:c})=>{const f=b(l);return r.default.createElement(o.Popover,{autoFocus:!1,enforceFocus:!0,interactionKind:"click",hasBackdrop:!0,position:d,onOpening:u,onClosed:c,content:a?r.default.createElement(h,{preset:f,value:e,onChange:t,store:l}):r.default.createElement("div",{style:{padding:"5px"}},r.default.createElement(p,{color:e,onChange:t,presetColors:f}))},r.default.createElement(m,{size:n,background:e,style:i},s))},exports.default=exports.ColorPicker;