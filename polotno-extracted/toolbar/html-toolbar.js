var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.HtmlToolbar=exports.DirectionInput=exports.FontColorInput=exports.FontStyleGroup=exports.TextBold=void 0;const t=e(require("react")),l=require("mobx-react-lite"),n=require("@blueprintjs/core"),o=require("@blueprintjs/icons"),i=require("./element-container"),r=e(require("./color-picker")),a=e(require("./filters-picker")),c=e(require("@meronex/icons/md/MdFormatTextdirectionRToL")),u=e(require("@meronex/icons/md/MdFormatTextdirectionLToR")),s=e(require("@meronex/icons/mdc/MdcFormatVerticalAlignTop")),m=e(require("@meronex/icons/mdc/MdcFormatVerticalAlignCenter")),d=e(require("@meronex/icons/mdc/MdcFormatVerticalAlignBottom")),f=e(require("@meronex/icons/mdc/MdcFormatListBulleted")),x=e(require("@meronex/icons/mdc/MdcFormatListNumbered")),p=require("./animations-picker"),g=require("../utils/flags"),b=require("./text-ai-write"),h=require("../canvas/html-element"),E=require("./text-toolbar"),T=({html:e})=>{const t=document.createElement("div");document.body.appendChild(t),t.style.display="none",t.style.whiteSpace="pre-wrap";const l=(0,h.createQuill)(t);return(0,h.setQuillContent)(l,e),l},v=e=>{e.root.parentElement.remove()},F=["left","center","right","justify"],q=["top","middle","bottom"],y={top:t.default.createElement("span",{className:"bp5-icon"},t.default.createElement(s.default,null)),middle:t.default.createElement("span",{className:"bp5-icon"},t.default.createElement(m.default,null)),bottom:t.default.createElement("span",{className:"bp5-icon"},t.default.createElement(d.default,null))},S=(0,l.observer)((({active:e,globalActive:l,format:o,element:i,disableGlobal:r,enableGlobal:a,icon:c})=>t.default.createElement(n.Button,{minimal:!0,icon:c,active:e,onMouseDown:e=>{e.preventDefault()},onClick:e=>{let t=window.__polotnoQuill;if(t){const e=t.getSelection();return t.formatText(e.index,e.length,o,!h.quillRef.currentFormat[o],"user"),void(l&&r())}t=T({html:i.text}),t.setSelection(0,t.getLength(),"api"),t.format(o,!1);const n=t.root.innerHTML;v(t),i.set({text:n}),l?r():a()}})));exports.TextBold=(0,l.observer)((({element:e,store:l})=>t.default.createElement(S,{format:"bold",active:h.quillRef.currentFormat.bold||"bold"===e.fontWeight||"700"===e.fontWeight,globalActive:"bold"===e.fontWeight||"700"===e.fontWeight,element:e,disableGlobal:()=>e.set({fontWeight:"normal"}),enableGlobal:()=>e.set({fontWeight:"bold"}),icon:t.default.createElement(o.Bold,null)}))),exports.FontStyleGroup=(0,l.observer)((({element:e,store:l,elements:i,components:r})=>{const a=(null==r?void 0:r.TextBold)||exports.TextBold;return t.default.createElement(n.ButtonGroup,null,t.default.createElement(a,{element:e,store:l}),t.default.createElement(S,{format:"italic",active:h.quillRef.currentFormat.italic||"italic"===e.fontStyle,globalActive:"italic"===e.fontStyle,element:e,disableGlobal:()=>e.set({fontStyle:"normal"}),enableGlobal:()=>e.set({fontStyle:"italic"}),icon:t.default.createElement(o.Italic,null)}),t.default.createElement(S,{format:"underline",active:h.quillRef.currentFormat.underline||e.textDecoration.indexOf("underline")>=0,globalActive:e.textDecoration.indexOf("underline")>=0,element:e,disableGlobal:()=>{let t=e.textDecoration.split(" ");t=t.filter((e=>"underline"!==e)),e.set({textDecoration:t.join(" ")})},enableGlobal:()=>{let t=e.textDecoration.split(" ");t.push("underline"),e.set({textDecoration:t.join(" ")})},icon:t.default.createElement(o.Underline,null)}),t.default.createElement(S,{format:"strike",active:h.quillRef.currentFormat.strike||e.textDecoration.indexOf("line-through")>=0,globalActive:e.textDecoration.indexOf("line-through")>=0,element:e,disableGlobal:()=>{let t=e.textDecoration.split(" ");t=t.filter((e=>"line-through"!==e)),e.set({textDecoration:t.join(" ")})},enableGlobal:()=>{let t=e.textDecoration.split(" ");t.push("line-through"),e.set({textDecoration:t.join(" ")})},icon:t.default.createElement(o.Strikethrough,null)}),t.default.createElement(n.Button,{minimal:!0,icon:"left"===e.align?t.default.createElement(o.AlignLeft,null):"center"===e.align?t.default.createElement(o.AlignCenter,null):"right"===e.align?t.default.createElement(o.AlignRight,null):t.default.createElement(o.AlignJustify,null),onClick:()=>{const t=(F.indexOf(e.align)+1+F.length)%F.length,n=F[t];l.history.transaction((()=>{i.forEach((e=>{e.set({align:n})}))}))}}),g.flags.textVerticalResizeEnabled&&t.default.createElement(n.Button,{minimal:!0,icon:y[e.verticalAlign],onClick:()=>{const t=(q.indexOf(e.verticalAlign)+1+q.length)%q.length,n=q[t];l.history.transaction((()=>{e.set({verticalAlign:n})}))}}),t.default.createElement(n.Button,{minimal:!0,icon:"bullet"===h.quillRef.currentFormat.list?t.default.createElement("span",{className:"bp5-icon"},t.default.createElement(x.default,{style:{width:"20px",height:"20px"}})):t.default.createElement("span",{className:"bp5-icon"},t.default.createElement(f.default,{style:{width:"20px",height:"20px"}})),onMouseDown:e=>{e.preventDefault()},onClick:()=>{let t=window.__polotnoQuill,l=!t;t=t||T({html:e.text}),l&&t.setSelection(0,t.getLength(),"api");const n=t.getFormat();n.list?"bullet"===n.list?t.format("list","ordered"):t.format("list",!1):t.format("list","bullet"),l&&(e.set({text:t.root.innerHTML}),v(t))}}))})),exports.FontColorInput=(0,l.observer)((({element:e,store:l})=>{const[n,o]=t.default.useState(null);return t.default.createElement(r.default,{value:h.quillRef.currentFormat.color||e.fill,gradientEnabled:!0,onOpen:()=>{const e=window.__polotnoQuill;e&&o(e.getSelection())},onClose:()=>{const e=window.__polotnoQuill;e&&e.setSelection(n)},onChange:t=>{const l=window.__polotnoQuill,o=(null==l?void 0:l.getSelection())||n;if(!o){var i=e.text.replace(/style=".*?"/g,"");return void e.set({fill:t,text:i})}const r=(null==o?void 0:o.length)>=(null==l?void 0:l.getLength())-1;l&&!r&&(null==o?void 0:o.length)?l.formatText(o.index,o.length,"color",t,"user"):(i=e.text.replace(/style=".*?"/g,""),e.set({fill:t,text:i}))},store:l})})),exports.DirectionInput=(0,l.observer)((({element:e})=>{const l="rtl"===e.dir?c.default:u.default;return t.default.createElement(n.Button,{icon:t.default.createElement(l,{className:"bp5-icon",style:{fontSize:"20px"}}),minimal:!0,onClick:()=>{e.set({dir:"rtl"===e.dir?"ltr":"rtl"})}})}));const A={TextFontFamily:E.TextFontFamily,TextFontSize:E.TextFontSize,TextFontVariant:exports.FontStyleGroup,TextFilters:a.default,TextFill:exports.FontColorInput,TextSpacing:E.TextSpacing,TextDirection:exports.DirectionInput,TextAnimations:p.AnimationsPicker,TextAiWrite:b.TextAiWrite};exports.HtmlToolbar=(0,l.observer)((({store:e,components:l})=>{const n=e.selectedElements,o=e.selectedElements[0],r=["TextFill","TextFontFamily","TextFontSize","TextFontVariant","TextSpacing","TextFilters",g.flags.animationsEnabled&&"TextAnimations","TextAiWrite"],a=(0,i.extendToolbar)({type:"text",usedItems:r,components:l});return t.default.createElement(i.ElementContainer,{items:a,itemRender:i=>{if("TextBold"===i){return null}const r=l[i]||A[i];return t.default.createElement(r,{element:o,elements:n,store:e,key:i,components:l})}})}));