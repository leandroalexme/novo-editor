var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextAiWrite=void 0;const t=e(require("react")),a=require("mobx-react-lite"),l=require("@blueprintjs/core"),o=require("@blueprintjs/icons"),n=require("@blueprintjs/core"),r=require("../utils/l10n"),i=require("../utils/api"),u=async({text:e="",command:t,tone:a})=>{try{const l=await fetch(i.URLS.aiText(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,command:t,tone:a})});if(!l.ok){const e=await l.text();throw console.error(e),new Error("Failed to rewrite text")}return(await l.json()).response}catch(l){return console.error(l),e}},c=[{text:"friendly"},{text:"professional"},{text:"humorous"},{text:"formal"}];exports.TextAiWrite=(0,a.observer)((({store:e})=>{const a=e.selectedElements.length>0,[i,d]=t.default.useState(!1),[s,m]=t.default.useState(!1),[f,x]=t.default.useState(1),[b,E]=t.default.useState(""),[p,g]=t.default.useState(""),[T,h]=t.default.useState(!1),y=t.default.useRef(null),v=e.selectedElements.some((e=>!e.contentEditable));t.default.useEffect((()=>{s&&1===f&&setTimeout((()=>{var e;null===(e=y.current)||void 0===e||e.focus()}),100)}),[s,f]);const C=async(t,a)=>{d(!0);const l=e.selectedElements[0].id,o=e.selectedElements[0].text,n=await u({text:o,command:t,tone:a}),r=e.getElementById(l);r&&(r.set({text:n}),d(!1))},k=async()=>{h(!0);const e=await u({command:"custom",tone:b});g(e),h(!1),x(2)};return v?null:i?t.default.createElement(l.Button,{icon:t.default.createElement(o.Clean,null),minimal:!0,text:"AI write",loading:!0}):t.default.createElement(t.default.Fragment,null,t.default.createElement(n.Popover,{disabled:!a,content:t.default.createElement(l.Menu,null,t.default.createElement(l.MenuItem,{text:(0,r.t)("toolbar.aiText.rewrite"),onClick:()=>{C("rewrite")}}),t.default.createElement(l.MenuItem,{text:(0,r.t)("toolbar.aiText.shorten"),onClick:()=>{C("shorten")}}),t.default.createElement(l.MenuItem,{text:(0,r.t)("toolbar.aiText.continue"),onClick:()=>{C("continue")}}),t.default.createElement(l.MenuItem,{text:(0,r.t)("toolbar.aiText.proofread"),onClick:()=>{C("proofread")}}),t.default.createElement("li",{className:"bp5-menu-header"},t.default.createElement("h6",{className:"bp5-heading"},(0,r.t)("toolbar.aiText.tones"))),c.map((e=>t.default.createElement(l.MenuItem,{key:e.text,text:(0,r.t)(`toolbar.aiText.${e.text}`),onClick:()=>{C("tone",e.text)}}))),t.default.createElement(l.MenuDivider,null),t.default.createElement(l.MenuItem,{text:(0,r.t)("toolbar.aiText.customPrompt"),onClick:e=>{e.preventDefault(),e.stopPropagation(),m(!0)}})),position:l.Position.BOTTOM},t.default.createElement(l.Button,{icon:t.default.createElement(o.Clean,null),minimal:!0,text:(0,r.t)("toolbar.aiText.aiWrite")})),t.default.createElement(n.Dialog,{isOpen:s,onClose:()=>{T||(m(!1),x(1),E(""),g(""))},title:1===f?(0,r.t)("toolbar.aiText.customPrompt"):(0,r.t)("toolbar.aiText.generatedResult")},1===f?t.default.createElement("div",{className:"bp5-dialog-body"},t.default.createElement(l.TextArea,{inputRef:y,value:b,onChange:e=>E(e.target.value),placeholder:(0,r.t)("toolbar.aiText.promptPlaceholder"),fill:!0,disabled:T,style:{minHeight:100}}),t.default.createElement("div",{className:"bp5-dialog-footer"},t.default.createElement("div",{className:"bp5-dialog-footer-actions"},t.default.createElement(l.Button,{onClick:()=>m(!1),text:(0,r.t)("toolbar.aiText.cancel"),disabled:T}),t.default.createElement(l.Button,{intent:"primary",onClick:k,loading:T,disabled:!b,text:(0,r.t)("toolbar.aiText.generate")})))):t.default.createElement("div",{className:"bp5-dialog-body"},t.default.createElement(l.TextArea,{value:p,onChange:e=>g(e.target.value),fill:!0,growVertically:!0,style:{minHeight:100}}),t.default.createElement("div",{className:"bp5-dialog-footer"},t.default.createElement("div",{className:"bp5-dialog-footer-actions"},t.default.createElement(l.Button,{onClick:()=>x(1),text:(0,r.t)("toolbar.aiText.back"),disabled:T}),t.default.createElement(l.Button,{onClick:k,text:(0,r.t)("toolbar.aiText.tryAgain"),loading:T}),t.default.createElement(l.Button,{intent:"primary",onClick:()=>{const t=e.selectedElements[0].id,a=e.getElementById(t);a&&a.set({text:p}),m(!1),x(1),E(""),g("")},text:(0,r.t)("toolbar.aiText.insert"),disabled:T}))))))}));