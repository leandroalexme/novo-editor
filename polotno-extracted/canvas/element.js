var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.registerShapeComponent=function(e,t){h[e]=t};const t=e(require("react")),n=require("mobx-react-lite"),r=e(require("konva")),l=require("./text-element"),o=require("./image-element"),i=require("./html-element"),a=require("./line-element"),u=require("./video-element"),s=require("./figure-element"),m=require("./gif-element"),d=require("react-konva"),f=require("./highlighter"),c=require("../model/group-model"),g=require("../utils/flags"),p=(0,n.observer)((e=>{const{element:n,store:r}=e,{children:l}=n,o=n.selectable||"admin"===r.role;return t.default.createElement(d.Group,{opacity:n.opacity,listening:o,hideInExport:!n.showInExport},l.map((n=>t.default.createElement(x,Object.assign({},e,{key:n.id,store:r,element:n})))))})),h={text:l.TextElement,image:o.ImageElement,svg:o.ImageElement,line:a.LineElement,video:u.VideoElement,figure:s.FigureElement,group:p,gif:m.GifElement},E=(e,t)=>{const n=[];(0,c.forEveryChild)(e,(e=>{"group"!==e.type&&n.push(e.a)}));const l=[];n.forEach((e=>{const t=[{x:0,y:0},{x:0+e.width,y:0},{x:0+e.width,y:0+e.height},{x:0,y:0+e.height}],n=new r.default.Transform;n.translate(e.x,e.y),n.rotate(r.default.Util.degToRad(e.rotation)),t.forEach((e=>{const t=n.point(e);l.push(t)}))}));const o=new r.default.Transform;o.rotate(-r.default.Util.degToRad(t));let i=1/0,a=1/0,u=-1/0,s=-1/0;l.forEach((e=>{const t=o.point(e);i=Math.min(i,t.x),a=Math.min(a,t.y),u=Math.max(u,t.x),s=Math.max(s,t.y)})),o.invert();const m=o.point({x:i,y:a});return{x:m.x,y:m.y,width:u-i,height:s-a,rotation:t}},x=(0,n.observer)((e=>{const{element:n,store:l}=e,[o,a]=t.default.useState(!1),u=l.selectedElements.indexOf(n)>=0&&n.selectable,s="group"===n.parent.type,m=(e=>{const[n,l]=t.default.useState(null);return t.default.useEffect((()=>{const t=setTimeout((()=>{const t=e.page.id,n=r.default.stages.find((e=>e.getAttr("pageId")===t));n||console.error("No stage is found for element",e.id),l(n)}));return()=>clearTimeout(t)}),[e.id]),n})(n),d=null==m?void 0:m.findOne("Transformer");t.default.useEffect((()=>{if(m){const e=e=>{const t=e.target.findAncestor(".element",!0),r=l.getElementById(null==t?void 0:t.id()),o=null==r?void 0:r.top,i=null==o?void 0:o.id;a(i===n.id)};m.on("mouseover",e);const t=()=>{a(!1)};return m.on("mouseleave",t),()=>{m.off("mouseover",e),m.off("mouseleave",t)}}}),[m]);let c=h[e.element.type];return"text"===e.element.type&&g.flags.htmlRenderEnabled&&(c=i.HTMLElement),e.element.visible?c?t.default.createElement(t.default.Fragment,null,t.default.createElement(c,Object.assign({},e)),(o||u)&&!s&&t.default.createElement(f.Highlighter,{element:"group"===n.type?{a:E(n,(null==d?void 0:d.rotation())||0)}:n})):(console.error("Can not find component for "+e.element.type),null):null}));exports.default=x;