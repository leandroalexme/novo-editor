var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.AudioElement=void 0;const t=e(require("react")),r=require("mobx-react-lite"),n=require("mobx");exports.AudioElement=(0,r.observer)((({audio:e,store:r})=>{const[i,u]=function(e){const[r,n]=t.default.useState(null),[i,u]=t.default.useState("loading");return t.default.useEffect((()=>{const t=new Audio(e),r=()=>{u("loaded"),n(t)},i=()=>{u("failed"),n(null)};return t.addEventListener("canplay",r),t.addEventListener("error",i),()=>{t.removeEventListener("canplay",r),t.removeEventListener("error",i)}}),[e]),[r,i]}(e.src);return t.default.useEffect((()=>{i&&r.history.ignore((()=>{e.set({duration:1e3*i.duration})}))}),[i,e,r.history]),t.default.useEffect((()=>{if(!i){return}const t=()=>{i.currentTime=e.startTime*e.duration/1e3},u=()=>{const t=e.endTime*e.duration/1e3;i.currentTime>=t&&(i.pause(),i.currentTime=e.startTime*e.duration/1e3)};i.addEventListener("ended",t),i.addEventListener("timeupdate",u);const a=(0,n.autorun)((()=>{const t=r.animatedElementsIds;if(t.length&&!t.includes(e.id)){return}const n=r.currentTime-e.delay,u=e.duration*(e.endTime-e.startTime),a=n>=0&&n<u;if(!r.isPlaying||0!==r.animatedElementsIds.length||!a){return void i.pause()}i.volume=e.volume,i.paused&&i.play();const s=n%u/1e3+e.startTime*e.duration/1e3,d=i.currentTime;Math.abs(d-s)>.5&&s!==d&&(i.currentTime=s)}));return()=>{i.pause(),i.removeEventListener("ended",t),i.removeEventListener("timeupdate",u),a()}}),[r.isPlaying,e.startTime,e.endTime,e.volume,i]),null}));