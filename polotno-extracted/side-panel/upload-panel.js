var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.UploadPanel=void 0,exports.setUploadFunc=function(e){f=e};const t=e(require("react")),i=require("@blueprintjs/core"),l=require("@blueprintjs/icons"),r=require("../utils/video"),o=require("../utils/file"),n=require("./images-grid"),s=require("../utils/l10n"),a=require("./select-image"),d=require("./select-video"),u=require("./select-svg"),c=require("./select-gif");let f=async e=>(0,o.localFileToURL)(e),p=[];function g(e){const{type:t}=e;return t.indexOf("svg")>=0?"svg":t.indexOf("gif")>=0?"gif":t.indexOf("image")>=0?"image":t.indexOf("video")>=0?"video":t.indexOf("audio")>=0?"audio":"image"}function m(){const e=new Blob(['\n    <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">\n      <circle cx="50" cy="50" r="45" fill="#f0f0f0" stroke="#ccc" stroke-width="2"/>\n      <path d="M40,35 L40,65 L55,50 L70,50 M70,35 Q80,50 70,65" fill="none" stroke="#666" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>\n    </svg>\n  '],{type:"image/svg+xml"});return URL.createObjectURL(e)}exports.UploadPanel=({store:e})=>{const[o,v]=t.default.useState(p),[h,x]=t.default.useState(!1),y=t.default.useRef(null);return t.default.useEffect((()=>{p=o}),[o]),t.default.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},t.default.createElement("div",{style:{height:"45px",paddingTop:"5px"}},(0,s.t)("sidePanel.uploadTip")),t.default.createElement("div",{style:{marginBottom:"20px"}},t.default.createElement("label",{htmlFor:"input-file"},t.default.createElement(i.Button,{icon:t.default.createElement(l.Plus,null),style:{width:"100%"},onClick:()=>{var e;null===(e=y.current)||void 0===e||e.click()}},(0,s.t)("sidePanel.uploadImage")),t.default.createElement("input",{type:"file",ref:y,style:{display:"none"},onChange:async e=>{const{target:t}=e;x(!0);try{for(const e of t.files){const t=await f(e),i=g(e);let l=t;"video"===i?l=await(0,r.getVideoPreview)(t):"audio"===i&&(l=m()),v((e=>e.concat([{url:t,type:i,preview:l}])))}}catch(e){console.error(e)}x(!1),t.value=""},multiple:!0}))),t.default.createElement(n.ImagesGrid,{images:o,isLoading:h,getPreview:e=>e.preview,hideNoResults:!0,onSelect:async(t,i,l)=>{const r=t.url,o=t.type;"image"===o?(0,a.selectImage)({src:r,store:e,droppedPos:i,targetElement:l}):"video"===o?(0,d.selectVideo)({src:r,store:e,droppedPos:i,targetElement:l}):"gif"===o?(0,c.selectGif)({src:r,store:e,droppedPos:i,targetElement:l}):"svg"===o?(0,u.selectSvg)({src:r,store:e,droppedPos:i,targetElement:l}):"audio"===o&&e.addAudio({src:r})}}))};