var e,t=this&&this.__createBinding||(Object.create?function(e,t,o,i){void 0===i&&(i=o);var a=Object.getOwnPropertyDescriptor(t,o);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,i,a)}:function(e,t,o,i){void 0===i&&(i=o),e[i]=t[o]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(e=function(t){return e=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e){Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o)}return t},e(t)},function(i){if(i&&i.__esModule){return i}var a={};if(null!=i){for(var n=e(i),r=0;r<n.length;r++){"default"!==n[r]&&t(a,i,n[r])}}return o(a,i),a}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.jsonToPPTX=async function({json:e}){const t=new n.default;t.defineLayout({name:"CUSTOM",width:e.width/100,height:e.height/100}),t.layout="CUSTOM";for(const o of e.pages){const e=t.addSlide();if(/\.(jpg|jpeg|png|gif)$/i.test(o.background)||o.background.startsWith("data:image")||o.background.startsWith("http")){await e.addImage({path:o.background,x:0,y:0,w:t.width,h:t.height,sizing:{type:"contain"}})}else{const t=c.default.Util.colorToRGBA(o.background),i=c.default.Util._rgbToHex(t.r,t.g,t.b);console.log(i),e.background={color:i}}for(const t of o.children){await g({element:t,slide:e})}}return t.writeFile("test.pptx"),t};const n=a(require("pptxgenjs")),r=require("./image"),l=i(require("./svg")),s=require("./figure-to-svg"),c=a(require("konva")),d=async({element:e,slide:t})=>{let{src:o}=e;if("svg"===e.type&&Object.keys(e.colorsReplace).length){const t=await l.urlToString(o);o=l.replaceColors(t,new Map(Object.entries(e.colorsReplace)))}const i=await(0,r.loadImage)(o),a=i.width*e.cropWidth,n=i.height*e.cropHeight,s=e.width/e.height;let c,d;const h=a/n;"svg"===e.type?(c=a,d=n):s>=h?(c=a,d=a/s):(c=n*s,d=n);const g=await(0,r.cropImage)(o,Object.assign(Object.assign({},e),{cropWidth:c/i.width,cropHeight:d/i.height})),u={x:e.x/100,y:e.y/100,w:e.width/100,h:e.height/100,rotate:e.rotation,flipH:e.flipX,flipV:e.flipY};e.shadowEnabled&&(u.shadow={type:"outer",blur:e.shadowBlur/2,offset:(e.shadowOffsetX+e.shadowOffsetY)/2,color:e.shadowColor,opacity:e.opacity}),await t.addImage(Object.assign({path:g},u))},h={image:d,svg:d,text:async({element:e,slide:t})=>{const o={x:e.x/100,y:"0%",w:e.width/100,h:e.height/10,fontSize:e.fontSize/2,fontFace:e.fontFamily,color:e.fill,align:e.align,bold:"bold"===e.fontWeight,italic:"italic"===e.fontStyle,underline:"underline"===e.textDecoration,lineSpacing:e.lineHeight,rotate:e.rotation,opacity:e.opacity,margin:0};e.backgroundEnabled&&(o.fill={color:e.backgroundColor}),await t.addText(e.text,o)},line:async({element:e,slide:t})=>{const o={x:e.x/100,y:e.y/100,w:e.width/100,h:e.height/100,line:{color:e.color,width:e.height,beginArrowType:"arrow"===e.startHead?"arrow":"none",endArrowType:"arrow"===e.endHead?"arrow":"none"},rotate:e.rotation,opacity:e.opacity};await t.addShape(n.default.ShapeType.line,o)},figure:async({element:e,slide:t})=>{const o=(0,s.figureToSvg)(e),i="data:image/svg+xml;base64,"+btoa(o),a={x:e.x/100,y:e.y/100,w:e.width/100,h:e.height/100,rotate:e.rotation,opacity:e.opacity};await t.addImage(Object.assign({path:i},a))}},g=async({element:e,slide:t})=>{if(!e.visible||!e.showInExport){return}const o=h[e.type];o?await o({element:e,slide:t}):console.warn(`PPTX export doesn't support ${e.type} type`)};